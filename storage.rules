
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Users can read any file by default, adjust if needed
    match /{allPaths=**} {
      allow read: if request.auth != null;
    }

    // Users can only write to their own designated profile folder.
    // The client SDK must upload files to this exact path format.
    match /users/{userId}/profile/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Admins can write to station documents
    match /stations/{stationId}/{docType}/{fileName} {
       allow write: if request.auth != null && request.auth.token.email == 'admin@riverph.com';
    }

     // Admins can write to user contract folder
    match /userContracts/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.token.email == 'admin@riverph.com';
    }

    // Admins can write to user delivery folder
    match /users/{userId}/deliveries/{fileName} {
      allow write: if request.auth != null && request.auth.token.email == 'admin@riverph.com';
    }

    // Users can upload proof of payment to their own payments folder
    match /users/{userId}/payments/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
